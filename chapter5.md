# Chapter 5 ブランチを使ってファイルを更新しよう

GitHubを用いたメジャーな作業フローで、イベントページの更新作業を行います。フローを実践する中で、ブランチという重要な機能についても学びます。しっかり手を動かして使いこなせるようになってくださいね。

<details><summary>Lesson 28 [ブランチの基本] ブランチとは何かを理解しましょう</summary>

ブランチは、同じリポジトリ内で並行して異なる作業をする際に役立つ重要な機能です。Gitを用いた開発を進める上では使いこなせることが必須と言えるでしょう。ここでは、まず基本を抑えるために、ブランチそのものについて解説します。

- ブランチで並行作業がしやすくなる
    
    ブランチは簡単にいうと、Gitで記録する履歴を枝分かれさせるための機能です。これまでは、コミットが一直線に並ぶようなイメージのみ紹介してきましたが、それだけでは不便なことも多々あります。
    
    例えば、同時に複数の異なる作業をしたい場合、内容ごとに別々に管理ができた方が望ましいです。また、アプリケーション開発をしていて、本番環境とテスト環境それぞれで異なるバージョンを動かしたいときも、ブランチを活用することでバージョンの切り替えが容易にできます。
    
    ※ブランチはGitの大きな強みです。使いこなせると、できることの幅がグッと広がりますよ。
    
- ブランチを統合することを「マージ」と呼ぶ
    
    枝分かれさせたブランチは、任意のタイミングで統合できます。この作業を「マージ」と呼びます。マージのタイミングや方法はさまざまですが、このあとの実践パートで紹介します。
    
- これまで使っていたのはmasterブランチ
    
    実は、これまでもすでにブランチを使っていました。Gitのリポジトリを作成すると自動で作られる、masterという名のブランチです。これは主となるバージョン(安定バージョン、最新バージョンなど)を管理するのに用います。レッスンの初めで紹介したように枝分かれした他のブランチで作業をしても、多くの場合、最終的にはmasterブランチにマージを行います。尚、このブランチに別の名前を付けることもできますが、慣習的にmasterまたはmainにすることがほとんどです。
    
- **ワンポイント** 作業人数に関係なく「作業の意味」ごとにブランチを作る
    
    masterは主となるブランチなので、安易に誤った内容を含めるわけにはいきません。そのため、作業用のブランチを作り、変更内容の確認や検証が済んだらmasterブランチにマージする、というフローが一般的です。本書では、GitHubが推奨しており、採用実績も多い「GitHubフロー」を用います。GitHubフローについてはこのChapter 5の最後で改めて解説します。
    
- **ワンポイント** ブランチ名をmasterからmainへ切り替える流れがある
    
    2020年に人権問題を背景とし、master/slaveなどいくつかのIT用語の使用を避けようという動きが起こりました。Gitの世界でもそれまで一般的だったmasterに代わってmainという名のブランチが浸透しつつあります。
    
    執筆時点で、GitHubでは最初に作られるブランチがmainとなっていますが、Gitとちぐはぐですよね。本書では、入門で躓かないよう一貫した説明をするため、そしてmasterのまま運用が続いているリポジトリも多いことから、masterブランチを使った説明を続けます。
### 用語
- **ブランチ**：Gitで記録する履歴を枝分かれさせるための機能。複数の作業を並行して進めるときに使用する。ブランチはマージ(統合)できる。
- **マージ**：枝分かれさせたブランチを統合すること。
    - マージはローカルリポジトリでGitコマンドにより実行することもできるし、GitHubを使ってリモートリポジトリ上でも行うことができる。</details>


<details><summary>Lesson 29 [ブランチを用いた実践1] 専用のブランチでイベント会場の情報を更新しましょう</summary>

ブランチを活用し、シガさんが作ったページ上のイベント開催会場を「株式会社〇〇」から「株式会社インプレス」に変更します。使うコマンドは今後も頻繁に使う基本的なものばかりなので、少しずつ覚えましょう。

- ブランチを用いてイベントの会場情報を更新する
    
    Chapter 4でローカルリポジトリに取得したサンプルプロジェクト(初心者向けGit勉強会のイベントページ)を編集しながら進めます。シガさんがページを作成したときには会場が未定だったため、「株式会社〇〇」と記載していましたが、「株式会社インプレス」で決定となりました。イチヤサさんは、イベント会場を更新するためのブランチを作成し、HTMLの編集とコミットを行います。コミットが完了したら、masterブランチにマージするための作業を行います。マージは、ローカルリポジトリでGitコマンドにより実行することもできますが、今回はGitHubを使ってリモートリポジトリ上で行います。それが完了すると会場情報の変更を無事プロジェクトに反映できたことになり、作成したブランチは役目を終えます。このような、短期的に使う作業用のブランチを「トピックブランチ」と呼びます。
    
    ※マージするときにGitHubの「プルリクエスト」という機能を利用します。
    
- ブランチを作成するためのGitコマンド
    
    ブランチを操作するためのgit branchコマンドを使うと、ブランチの作成ができます。作成したいブランチの名前を指定して実行します。
    
    - git branchコマンド
        
        ```bash
        $ git branch update-venue
        # git branch = git branchコマンド
        # update-venue = 作成するブランチ名
        ```
        
    
    ※作成、名前の変更、削除など、ブランチに対する操作を行えるのがgit branchコマンドです。
    
- ブランチは切り替えながら使用する
    
    ブランチが複数存在する状況では、「どのブランチに対して操作を行うか」ということを意識しなくてはなりません。操作対象となるブランチを指定するには、git checkoutコマンドを用います。このコマンドを実行すると、それ以降の操作対象が切り替わり、指定したブランチが使われるようになります。例えば、update-venueブランチをチェックアウトした後にコミットをすると、update-venueブランチのみコミットが追加され、それ以外のブランチには追加されません。
    
    - git checkoutコマンド
        
        ```bash
        $ git checkout update-venue
        # git checkout = git checkoutコマンド
        # rpdate-venue = 切り替え先のブランチ名
        ```
        
    
    ※はじめは複数のブランチを使うことに混乱するかもしれませんが、ゆっくりと確認しながら作業して慣れていきましょう。
    
- ブランチを作成して切り替える
    1. ブランチを作成する
        1. git branchコマンドを用い、ブランチを作成します。ここでは、「開催会場を更新する」という作業内容を示す「update-venue」という名前のブランチにします。
        
        ```bash
        $ git branch update-venue
        
        % git branch update-venue
        ```
        
        ※もし打ち間違いなどでブランチ名を誤って作成してしまったら、再度改めて正しいブランチ名でコマンドを実行すれば大丈夫です。誤った名前の不要なブランチは、P.206に記載の手順で削除できます。
        
    2. 使用中のブランチを確認する
        1. ブランチ名の指定なしにgit branchコマンドを実行すると、作成済みのブランチ一覧と現在使用中のブランチを確認できます。先頭にアスタリスク(*)が付いているのが、今使っているブランチです。
        
        ```bash
        $ git branch
        
        % git branch
        * master # *が付いているのが今使っているブランチを意味する masterブランチを使用していることがわかる
          update-venue # 先程作成したupdate-venueブランチ
        ```
        
        ※Git Bashでは、カレントディレクトリと一緒に「(使用中のブランチ名)」が表示されているので、すぐに確認できます。
        
    - **ワンポイント** git checkoutコマンドに代わるコマンド
        
        Chapther 3で紹介したとおり、git checkoutコマンドによるブランチの切り替えはgit switchコマンドでも実行できます。これ以降、必要に応じてgit switchを使う方法も紹介します。
        
    1. ブランチをチェックアウトする
        1. 今はまだmasterブランチを使用していることがわかりました。先程作成したupdate-venueブランチへと切り替えるには、「チェックアウト」という操作が必要です。使いたいブランチ名を指定し、git checkoutコマンドを実行してみましょう。
        
        ```bash
        $ git checkout update-venue # update-venueブランチに切り替える
        
        % git checkout update-venue # git switch update-venueでも同じことができる
        Switched to branch 'update-venue' # update-venueブランチに切り替わった
        ```
        
    2. 使用中のブランチを確認する
        1. 再びgit branchコマンドで確認すると、update-venueブランチに切り替わったことがわかります。
        
        ```bash
        $ git branch
        
        % git branch
          master
        * update-venue # *がupdate-venueブランチに付き、現在使用中のブランチがmasterから切り替わったことがわかる
        ```
        
    - **Point** git statusコマンドで確認する
        
        git statusコマンドでも使用中のブランチを確認できます。コマンドを実行するとOn branchに続いて表示されるのが現在使っているブランチです。
        
        ```bash
        % git status
        On branch update-venue # git statusコマンドで使用中のブランチが表示される
        nothing to commit, working tree clean
        ```
        
- ファイルを編集してコミットする
    1. index.htmlを編集する
        1. codeコマンドでVisual Studio Codeを起動し、index.htmlを開きましょう(P.139参照)。「株式会社〇〇イベントセミナー会場」という箇所を書き換えて保存します。

    2. 状態を確認する
        1. 対象ファイルの状態を確認したのち、コミットしてみましょう。先ずはgit stautsコマンドで状態を確認します。
        
        ```bash
        $ git status
        
        % git status
        On branch update-venue
        Changes not staged for commit:
          (use "git add <file>..." to update what will be committed)
          (use "git restore <file>..." to discard changes in working directory)
        	modified:   index.html # index.htmlが「modhified(変更済み)」になっている
        
        no changes added to commit (use "git add" and/or "git commit -a")
        ```
        
    3. 変更をコミットする
        1. git addコマンドでindex.htmlをステージングエリアに登録し、git commitコマンドでコミットします。素早くコミットできる -mオプションを使いましょう。いずれもChapter 3で学習しました。
        
        ```bash
        # コマンドを1行ずつ入力してreturnキーを押すこと
        $ git add index.html
        $ git commit -m "会場を株式会社インプレスに更新した"
        
        % git add index.html
        % git commit -m "会場を株式会社インプレスに更新した"
        [update-venue 93c44d0] 会場を株式会社インプレスに更新した
         1 file changed, 1 insertion(+), 1 deletion(-)
        ```
        
    4. ブランチに対する操作を確認する
        1. これで、update-venueブランチでの作業は完了です。このあと、このブランチをmasterブランチにマージします。その前に、今使っているブランチをmasterブランチと比較してみましょう。Chapter 3で紹介したgit diffコマンドを用いると、ブランチ同士の比較を行うことも可能です。パラメーターに比較対象のブランチを指定して実行してみましょう。会場変更が反映されていることを確認できるはずです。
        
        ```bash
        $ git diff master
        
        % git diff master # 使用中のブランチとmasterブランチとの差分が表示される
        diff --git a/index.html b/index.html
        index b3405fb..3d80220 100644
        --- a/index.html
        +++ b/index.html
        @@ -55,7 +55,7 @@
                             <article>
                                 <h3>イベント日時・場所</h3>
                                 <p>3月23日 19:00開始</p>
        -                        <p>株式会社〇〇 イベントセミナー会場</p> # マイナス記号と赤色の文字は変更前の行
        +                        <p>株式会社インプレス イベントセミナー会場</p> # プラス記号と緑色の文字は変更後の行
                             </article>
                             <article>
                                 <h3>スピーカー</h3>
        ```

        ※マイナス記号と赤色の文字は変更前の行、プラス記号と緑色の文字は変更後の行を表します。
### 用語
- **マージ**：枝分かれさせたブランチを統合すること。
    - マージはローカルリポジトリでGitコマンドにより実行することもできるし、GitHubを使ってリモートリポジトリ上でも行うことができる。
- **トピックブランチ**：短期用に使う作業用にブランチのことを指す。
- **git branchコマンド**：作成、名前の変更、削除など、ブランチに対する操作を行えるコマンド。
    - **(ブランチ名の指定なしに)git branchコマンドを実行**：作成済みのブランチ一覧と現在使用中のブランチを確認できる。
- **git checkoutコマンド**：操作対象となるブランチを指定するコマンド。このコマンドを実行すると、それ以降の操作対象が切り替わり、指定したブランチが使われるようになる。
    - **git checkout 使いたいブランチ名**：使いたいブランチに切り替わる。
- **git switchコマンド**：ブランチを切り替える。
- **git statusコマンド**：現在の状態を確認する。
- **codeコマンド**：ターミナルからVisual Studio Codeを起動できる。
    - codeコマンドのあとにディレクトリパスを書く。すでにローカルリポジトリのディレクトリを表示している場合は、カレントディレクトリを表す相対パスの「.」(ドット)を指定するだけで済む。
- **git addコマンド**：ステージングエリアにファイルを登録する。
    - **ステージングエリア**：コミットするファイルを登録する場所。
- **git commitコマンド**：コミットを作成する(ファイルはステージングエリアからGitディレクトリに移動する(コミット(記録)される))。
    - **git commit -m**：コマンドラインから直接コミットメッセージを指定できる。この時、コミットメッセージは「"」ダブルクォーテーションで囲むこと。
- **git diff**：各エリアの差分を確認する。
- **git diff 比較対象のブランチ名**：ブランチ同士の比較を行うことも可能。</details>


<details><summary>Lesson 30 [ブランチを用いた実践2] プルリクエストを作成しましょう</summary>

作成したブランチをmasterブランチへマージするための準備として、プルリクエストを作成します。ここからはGitHubを使うことも増えてくるので、ターミナルとブラウザーを行ったり来たり忙しくなりますが、チーム開発を想像しながら進めましょう。

- プルリクエストで変更をチームのみんなに知らせる
    
プルリクエスト(pull request)は、GitHubが提供している機能です。「リクエスト」という名からもわかるように、作成したブランチの取り込みを依頼する際に用います。プルリクエストを作成すると、自分がプロジェクトに対し加えた変更を他の開発者に知らせ、その内容について議論できるようになります。尚、プルリクエストを使った議論は、変更を加えた人以外が内容をチェックするという意味で一般的に「レビュー」と呼ばれます。レビューの結果、プロジェクトに取り込む判断がされたブランチはマージすることができますが、修正が必要な場合や、マージをしない判断が下される場合もあります。このシナリオでは、イチヤサさんがシガさんにレビューを依頼するものとします。また、レビューする側を「レビュアー」、される側を「レビュイー」と呼びます。
    
- 「プッシュ」で変更をリモートリポジトリに反映する
    
    プルリクエストを用いたレビューやマージはリモートリポジトリの内容をもとに行うため、ローカルリポジトリからコミットを反映させる必要があります。「プッシュ」という操作を行うと、リモートリポジトリにも同じ内容のブランチが作成されます。その際、特に指定をしなければブランチ名もそのまま同じものが引き継がれますし、別名を付けることも可能です。ただし1つのリポジトリには同じ名前のブランチを2つ以上作成できないので覚えておきましょう。
    
    プッシュはgit pushというコマンドを使います。次のように実行すると、指定したリモートリポジトリ上に、指定したブランチと同じ名前、同じ内容のブランチが作成されます。
    
    - git pushコマンド
        
        ```bash
        $ git push origin update-venue
        # git push = git pushコマンド
        # origin = プッシュ先のリモートリポジトリの名前
        # update-venue = プッシュするブランチ名
        ```
        
- プルリクエストを作成しよう
    1. ブランチをプッシュする
        1. プルリクエストを作成するには、リモートリポジトリ上にブランチが必要です。先ずは先程のupdate-venueブランチをリモートリポジトリにプッシュしましょう。
        
        ```bash
        $ git push origin update-venue # update-venueブランチをリモートリポジトリにプッシュする
        
        % git push origin update-venue
        Enter passphrase for key '/Users/yoshiwo/.ssh/id_ed25519': # パスフレーズを要求されるので入力
        Enumerating objects: 5, done.
        Counting objects: 100% (5/5), done.
        Delta compression using up to 8 threads
        Compressing objects: 100% (3/3), done.
        Writing objects: 100% (3/3), 363 bytes | 363.00 KiB/s, done.
        Total 3 (delta 2), reused 0 (delta 0), pack-reused 0
        remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
        remote: 
        remote: Create a pull request for 'update-venue' on GitHub by visiting:
        remote:      https://github.com/YSWEngineer/ichiyasaGitSample/pull/new/update-venue
        remote: 
        To github.com:YSWEngineer/ichiyasaGitSample.git
         * [new branch]      update-venue -> update-venue
        # これでリモートリポジトリにプッシュされる
        ```
        
    2. masterブランチへのプルリクエスト作成を開始する
        1. プッシュの後、GitHubのichiyasaGitSampleリポジトリをブラウザーで開きます。すると新たに黄色い英亜が表示され、更新されたブランチがあることを確認できます(見当たらない場合、P.157のワンポイントに記載の手順を試してください)。ここからプルリクエスト作成画面に遷移します。
    3. レビュー対象のブランチを選択する
        1. はじめに、レビューの対象としたいトピックブランチとマージ先のブランチ(GitHub上での表示に倣い、プルリクエストでのマージ先をこれ以降ベースブランチと呼びます)を正しく設定しましょう。タイトル入力欄のすぐ上にある選択欄で、左側にベースブランチ、右側にトピックブランチを指定します。

        - **Point** リポジトリとブランチの選択が必要
            
            フォークを行なった場合、リポジトリの指定も必要なので注意してください。デフォルトではフォーク元のyasagit-2/ichiyasaGitSampleがベースブランチに指定されているので、自分のアカウントのリモートリポジトリを選択しなおします。
            
    4. ベースブランチとトピックブランチを選択する
        1. 左側のベースブランチで自分のアカウントのリポジトリを選択します。自分のアカウントのリポジトリのページに遷移するので、ベースブランチとトピックブランチにそれぞれmasterブランチ、update-venueブランチを選択してください。

    5. プルリクエストに必要な情報を入力する
        1. 作成画面には、プルリクエストのタイトルと自由に書けるコメントの入力欄があります。どんな変更を加えたのか、わかりやすく書きましょう。今回は、サンプルとして以下のように記載しています。

        
        ※GitHubでコメントを入力する部分ではMarkdownが使えます。
        
    6. Reviewersにレビュアーを指定する
        1. レビュアーをしてします。例えばシガさんにレビューをお願いしたい場合、画面右側の「Reviewers」にシガさんのユーザー名(shiga-iyg-2)を選択すれば完了です。尚、レビュアーとなるにはそのリポジトリに権限が必要です(P.156参照)。
    7. プルリクエストの内容を確定する
        1. 最後に[Create pull request]をクリックすれば、プルリクエストの作成が完了します。
                
    - **ワンポイント** レビュアーにリポジトリの編集権限を与える
        
        レビュアーに指定できるのは、リポジトリの「コラボレーター(共同編集者)」となっているアカウントです。[Settings]タブで設定します。コラボレーターは、そのリポジトリにプッシュする権限を持ちます。
                
    - **ワンポイント** プルリクエストは専用画面から作成することもできる
        
        先程のプルリクエストは、ブランチをプッシュしたら画面に表示される[Compare & pull request]から作成しました(P.152参照)。実はこのボタンはプッシュから一定時間が経つと表示されなくなります。それ以降にプルリクエストを作りたい際は、[Pull requests]タブの[New pull request]ボタンをクリックしましょう。
### 用語
- **pull request(プルリクエスト)**：マージの依頼のこと。GitHubが提供している機能の一つ。作成したブランチの取り込みを依頼する際に用いる。
- **レビュー**：プルリクエストを使った議論のこと。変更を加えた人以外が内容をチェックするという意味。
- **マージ**：枝分かれさせたブランチを統合すること。
- **レビュアー**：レビューする側のこと。
- **レビュイー**：レビューされる側のこと。
- **プッシュ**：ローカルリポジトリからリモートリポジトリに反映すること。
- **ブランチ**：Gitで記録する履歴を枝分かれさせるための機能。複数の作業を並行して進めるときに使用する。
- **フォーク**：リポジトリを複製するGitHubの機能。複製元となるオリジナルのリポジトリに影響を与えることなく、ファイルに変更を加えることができる。
- **ベースブランチ**：プルリクエストでのマージ先のブランチ。</details>


<details><summary>Lesson 31 [ブランチを用いた実践3] プルリクエストをレビューしてもらいましょう</summary>

このLessonでは、作成したプルリクエストの中身をチームメンバーにレビューしてもらい、マージするための準備を終えるところまでの手順を紹介します。先程までとは視点を変え、レビュー担当者になったつもりで読んでくださいね。

- レビューで確認する内容
    
作成したプルリクエストをマージするために、レビューの工程に移ります。ところで、レビューでは、どんなチェックを行えば良いのでしょうか。これは、プロジェクトごと、レビュアーごとに異なるので、明確な答えがありません。例を挙げると、ソースコードのレビューでは、①ロジックに誤りがないか、②設計が適切か、③他の人によって読みやすいか、④必要なテストコードが書かれているか、⑤ソースコードコメントが十分か？などのポイントがあります。また、今回のサンプルプロジェクトのようにユーザーインターフェースがある場合はデザインや操作性もチェック対象でしょうし、議事録ならば言葉遣いを確認するかもしれません。是非、GitHubでオープンに繰り広げられている議論や、所属しているプロジェクトのレビューなどから学び、感覚を養っていってください。
    
    ※修正点の指摘やネガディブなフィードバックだけがレビューではありません。「綺麗なソースコードですね」「表現がわかりやすいです」といったポジティブなコメントも、積極的に書き込んでみましょう。
    
- プルリクエストのレビューをしよう
    1. プルリクエストの内容をブラウザー上でレビューする
        1. レビュアーに指定されたシガさんは、プルリクエストの内容を確認し、マージ可能かどうかを判断します。今回は、会場の変更内容が正しいかどうか確認できればいいでしょう。プルリクエストの画面で[Files changed]タブをクリックすると、変更前・変更後の内容が比較できます。変更が多い場合や、変更内容を時系列に沿ってみたい場合などは、[Commits]タブをクリックしてコミットごとの確認を行うのもおすすめです。
                
    2. レビューの結果をプルリクエスト作成者に伝える
        1. レビューが完了したら、シガさんはその旨をプルリクエストにコメントします。ここではサンプルとして、次のように入力しました。プルリクエストのマージはLesson 33で実行します。
        
        - **Point** マージの実行者はチームによって異なる
            
            レビュー完了後、マージを誰が行うかはチームによって異なります。今回はレビュアーが実行するフローを紹介していますが、筆者の経験では、レビューを依頼した人がマージするという取り決めをしているチームもありました。どちらを瀬卓するか決める際は、マージの影響をしっかり把握した人が、適切なタイミングで操作を行えるルールになっていることが大切です。
            
- **ワンポイント** 略語を活用し、プルリクエストでの議論をスムーズに
    
    GitHubでのコミュニケーションには、略語を活用する独特の文化があります。最も有名なのが、「問題ないと思う」「良いと思う」という意味の「LGTM(Looks Good To Me)」です。様々な場面で使えますが、プルリクエストの内容を承諾する意味でレビュアーがLGTMを伝えるのは定番です。LGTMと書かれた面白い画像を貼ることもよくあります。LGTM以外にもさまざまな言葉が使われているので、興味がある方は是非調べてみてください。
    
- **ワンポイント** プルリクエストのタイトルやコメントを編集する
    
    プルリクエストに入力した内容は後から編集もできます。タイトルは、右側にある[Edit]ボタンをクリックすると、編集できる状態に気変わります。また、コメントを編集するには、右上にある[…]ボタンをクリックし、[Edit]というメニューを選択します。
    
- Lesson 32 [ブランチを用いた実践4] GitHubのレビュー機能を使いこなしましょう
